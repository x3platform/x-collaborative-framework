// -*- ecoding=utf-8 -*-
// Name		:x-client-api 
// Version	:1.0.0 
// Author	:ruanyu@live.com 
// Date		:2016-06-01
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a){function b(a){return a.replace(n,"").replace(o,",").replace(p,"").replace(q,"").replace(r,"").split(/^$|,+/)}function c(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function d(a,d){function e(a){return o+=a.split(/\n/).length-1,m&&(a=a.replace(/\s+/g," ").replace(/<!--.*?-->/g,"")),a&&(a=r[1]+c(a)+r[2]+"\n"),a}function f(a){var c=o;if(l?a=l(a,d):g&&(a=a.replace(/\n/g,function(){return o++,"$line="+o+";"})),0===a.indexOf("=")){var e=n&&!/^=[=#]/.test(a);if(a=a.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=a.replace(/\s*\([^\)]+\)/,"");i[f]||/^(include|print)$/.test(f)||(a="$escape("+a+")")}else a="$string("+a+")";a=r[1]+a+r[2]}return g&&(a="$line="+c+";"+a),x.each(b(a),function(a,b){if(b&&!p[b]){var c;c="print"===b?t:"include"===b?u:i[b]?"$utils."+b:j[b]?"$helpers."+b:"$data."+b,v+=b+"="+c+",",p[b]=!0}}),a+"\n"}var g=d.debug,h=d.openTag,k=d.closeTag,l=d.parser,m=d.compress,n=d.escape,o=1,p={$data:1,$fileName:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,r=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],s=q?"$out+=text;return $out;":"$out.push(text);",t="function(){var text=''.concat.apply('',arguments);"+s+"}",u="function(fileName,data){data=data||$data;var text=$utils.$include(fileName,data,$fileName);"+s+"}",v="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),w=r[0],y="return new String("+r[3]+");";x.each(a.split(h),function(a,b){b=b.split(k);var c=b[0],d=b[1];1===b.length?w+=e(c):(w+=f(c),d&&(w+=e(d)))});var z=v+w+y;g&&(z="try{"+z+"}catch(ex){throw {fileName:$fileName,name:'Render Error',message:ex.message,line:$line,source:"+c(a)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$fileName",z);return A.prototype=i,A}catch(B){throw B.temp="function anonymous($data,$fileName) {"+z+"}",B}}var e=function(a){return a.fileName?"string"==typeof a.context?l(a.data,{fileName:a.fileName}):h(a.fileName,a.data):l(a.content,x.ext(a,{fileName:"tmp-"+x.randomText.create(8)}))(a.data)};e.version="3.0.0",e.config=function(a,b){f[a]=b};var f=e.defaults={openTag:"{{",closeTag:"}}",escape:!1,cache:!0,compress:!1,parser:null},g=e.cache={};e.render=function(a,b){return l(a,b)};var h=e.renderFile=function(a,b){var c=e.get(a)||k({fileName:a,name:"Render Error",message:"Template not found"});return b?c(b):c};e.get=function(a){var b;if(g[a])b=g[a];else if("object"==typeof document){var c=x.query(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");d=e.xml.parse(x.string.trim(d)),b=l(d,{fileName:a})}}return b};var i=e.utils={$helpers:{},$include:h,$string:x.string.stringify,$escape:x.encoding.html.encode,$foreach:x.each};e.helper=function(a,b){j[a]=b};var j=e.helpers=i.$helpers;e.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";x.debug.error(b)};var k=function(a){return e.onerror(a),function(){return"{Template Error}"}};e.xml={parse:function(a){var b=e.xml.syntax(a);return b.join("")},syntax:function(a){var b=[];b=e.xml.array(a);for(var c=0;c<b.length;c++)if(-1==b[c].indexOf("</")&&b[c].indexOf("<")<b[c].indexOf(">")){var d=b[c],f=e.xml.closeTag(d),g=d.match(/x-(if|else|foreach)\=\"([a-zA-Z0-9-_\=\/\' ]+)\"/);x.isArray(g)&&3==g.length&&(d=d.replace(g[0],""),"foreach"==g[1]?(b[c]=d+"{{foreach "+g[2]+"}}",b=e.xml.injectionCode(b,c,d,f,g[1])):"if"==g[1]?(b[c]="{{if "+g[2]+"}}"+d,b=e.xml.injectionCode(b,c,d,f,g[1])):"else"==g[1]&&(b[c]="{{else}}"+d))}return b=e.xml.array(b.join(""))},array:function(){var a=[],b=[];b=arguments[0].split(/</g),x.each(b,function(b,c){a[a.length]=""!=x.string.trim(c)&&b>0?"<"+c:c}),b=a,a=[];for(var c=0;c<b.length;c++){var d=x.string.trim(b[c]);if(""!=d){if(-1==d.indexOf(">")){a[a.length]=d;continue}for(var e=d.split(/>/g),f=0;f<e.length;f++)""!=e[f]&&(a[a.length]=0==e[f].indexOf("<")?e[f]+">":e[f])}}b=a,a=[];for(var c=0;c<b.length;c++){var d=x.string.trim(b[c]);if(""!=d){if(-1==d.indexOf("{{")){a[a.length]=d;continue}for(var e=d.split(/{{/g),f=0;f<e.length;f++)""!=e[f]&&(a[a.length]=f>0?"{{"+e[f]:e[f])}}b=a,a=[];for(var c=0;c<b.length;c++){var d=x.string.trim(b[c]);if(""!=d){if(-1==d.indexOf("}}")){a[a.length]=d;continue}for(var e=d.split(/}}/g),f=0;f<e.length;f++)""!=e[f]&&(a[a.length]=e[f].indexOf("{{")>-1?e[f]+"}}":e[f])}}for(var c=0;c<a.length;c++){var g=!1;a[c].indexOf("<")<a[c].indexOf(" />")?g=!0:-1==a[c].indexOf("</")&&a[c].indexOf("<")<a[c].indexOf(">")?g=!0:a[c].indexOf("</")<a[c].indexOf(">")&&(g=!0),g&&(a[c]=a[c].toLowerCase().trim())}return a},closeTag:function(a){var b=a.match(/(<?\w+)|(<\/?\w+)\s/);return b&&!b[0].match(/img|input/)?"</"+b[0].replace("<","")+">":null},injectionCode:function(a,b,c,d,e){var f=0;c=c.match(/<\w+/)[0];for(var g=b+1;g<a.length;g++){if(a[g]==d){if(f>0){f--;continue}"foreach"==e?a[g]="{{/"+e+"}}"+a[g]:"if"==e&&(a[g]=a[g]+"{{/"+e+"}}");break}(a[g].indexOf(c+">")>-1||a[g].indexOf(c+" ")>-1)&&f++}return a}};var l=e.compile=function(a,b){function c(c){try{return new h(c,f)+""}catch(d){return b.debug?k(d)():(b.debug=!0,l(a,b)(c))}}b=x.ext(e.defaults,b||{});var f=b.fileName;try{var h=d(a,b)}catch(i){return i.fileName=f||"anonymous",i.name="Syntax Error",k(i)}return c.prototype=h.prototype,c.toString=function(){return h.toString()},f&&b.cache&&(g[f]=c),c},m="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",n=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,o=/[^\w$]+/g,p=new RegExp(["\\b"+m.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),q=/^\d[^,]*|,\d[^,]*/g,r=/^,+|,+$/g,s=function(a,b){var c=b.split(":"),d=c.shift(),e=c.join(":")||"";return e&&(e=", "+e),"$helpers."+d+"("+a+e+")"};return f.parser=function(a,b){a=a.replace(/^\s/,"");var c=a.split(" "),d=c.shift(),f=c.join(" ");switch(d){case"if":a="if("+f+"){";break;case"else":c="if"===c.shift()?" if("+c.join(" ")+")":"",a="}else"+c+"{";break;case"/if":a="}";break;case"foreach":if(3==c.length&&"in"==c[1]){var g=c[2]||"$data",h=c[0]||"$value",i="$index,"+h;a="$foreach("+g+",function("+i+"){"}else if(4==c.length&&"in"==c[2]){var g=c[3]||"$data",h=c[1]||"$value",j=c[0]||"$index",i=j+","+h;a="$foreach("+g+",function("+i+"){"}else{var g=c[3]||"$data",k=c[2]||"in",h=c[1]||"$value",j=c[0]||"$index",i=j+","+h;"in"!==k&&(g="[]"),a="$foreach("+g+",function("+i+"){"}break;case"/foreach":a="});";break;case"echo":a="print("+f+");";break;case"print":case"include":a=d+"("+c.join(",")+");";break;default:if(-1!==f.indexOf("|")){var l=b.escape;0===a.indexOf("#")&&(a=a.substr(1),l=!1);for(var m=0,n=a.split("|"),o=n.length,p=l?"$escape":"$string",q=p+"("+n[m++]+")";o>m;m++)q=s(q,n[m]);a="=#"+q}else a=e.helpers[d]?"=#"+d+"("+c.join(",")+");":"="+a}return a},"function"==typeof define&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:a.x.template=e,e});